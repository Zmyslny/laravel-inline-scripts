name: Tests

on:
    push:
    pull_request:

jobs:
    test:
        runs-on: ubuntu-latest
        steps:
        -   name: Checkout
            uses: actions/checkout@v4

        -   name: Setup PHP
            uses: shivammathur/setup-php@v2
            with:
                php-version: '8.2'
                tools: composer:v2

        -   name: Setup Node.js
            uses: actions/setup-node@v4
            with:
                node-version: '20'
                cache: 'npm'

        -   name: Install PHP dependencies
            run: composer install --prefer-dist --no-progress

        -   name: Install npm dependencies
            run: npm ci

        -   name: Unit tests with coverage
            run: composer test:unit:co

        -   name: Type coverage
            run: composer test:type-co

        -   name: PHPStan
            run: composer test:stan

        -   name: Rector tests
            run: composer test:refa

        -   name: Test PHP formating
            run: composer test:format:php

        -   name: JavaScript tests
            run: composer test:js

        -   name: Tests JS linting
            run: composer test:lint

        -   name: Tests JS formating
            run: composer test:format:js
